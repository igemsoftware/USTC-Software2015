window.BioBLESS={plugins:["home","device","simulator"]};BioBLESS.get_current_plugin_stage=function(){return BioBLESS.plugin_stage};BioBLESS.animation=new Array;BioBLESS.animation[BioBLESS.animation.length]=function(){if(BioBLESS.get_current_plugin_stage()!=null){if(Math.abs(BioBLESS.get_current_plugin_stage().movable_stage.scale.x-BioBLESS.get_current_plugin_stage().movable_stage._scale)>.001){if(BioBLESS.get_current_plugin_stage().movable_stage.inPosition==null){BioBLESS.get_current_plugin_stage().movable_stage.inPosition=function(){};BioBLESS.get_current_plugin_stage().movable_stage.inPosition.x=BioBLESS.width/2;BioBLESS.get_current_plugin_stage().movable_stage.inPosition.y=BioBLESS.height/2}BioBLESS.get_current_plugin_stage().movable_stage.position.x+=(BioBLESS.get_current_plugin_stage().movable_stage.scale.x-BioBLESS.get_current_plugin_stage().movable_stage._scale)*.25*BioBLESS.get_current_plugin_stage().movable_stage.inPosition.x;BioBLESS.get_current_plugin_stage().movable_stage.position.y+=(BioBLESS.get_current_plugin_stage().movable_stage.scale.y-BioBLESS.get_current_plugin_stage().movable_stage._scale)*.25*BioBLESS.get_current_plugin_stage().movable_stage.inPosition.y;BioBLESS.get_current_plugin_stage().movable_stage.scale.x-=(BioBLESS.get_current_plugin_stage().movable_stage.scale.x-BioBLESS.get_current_plugin_stage().movable_stage._scale)*.25;BioBLESS.get_current_plugin_stage().movable_stage.scale.y-=(BioBLESS.get_current_plugin_stage().movable_stage.scale.y-BioBLESS.get_current_plugin_stage().movable_stage._scale)*.25}else BioBLESS.get_current_plugin_stage().movable_stage.scale.x=BioBLESS.get_current_plugin_stage().movable_stage.scale.y=BioBLESS.get_current_plugin_stage().movable_stage._scale}};BioBLESS.prepare_navigation=function(){BioBLESS.navigation=new PIXI.Container;BioBLESS.navigation.condition=0;BioBLESS.navigation.h=120*BioBLESS.plugins.length+160;BioBLESS.navigation.w=120;var background=new PIXI.Graphics;background.beginFill(0,1);background.lineStyle(0);background.drawRect(0,0,this.navigation.w,this.navigation.h);background.endFill();background.lineStyle(3,16777215,1);BioBLESS.navigation.button=new Array;for(var i=1;i<BioBLESS.plugins.length+1;i++){var j=i-1;BioBLESS.navigation.button[j]=new PIXI.Graphics;BioBLESS.navigation.button[j].lineStyle(3,16777215,1);BioBLESS.navigation.button[j].beginFill(0,0);BioBLESS.navigation.button[j].drawCircle(60,60+i*120,50);BioBLESS.navigation.button[j].endFill();BioBLESS.navigation.button[j].title=new PIXI.Text(BioBLESS.plugins[j],{fill:"#ffffff"});BioBLESS.navigation.button[j].title.anchor.x=.5;BioBLESS.navigation.button[j].title.anchor.y=.5;if(BioBLESS.plugins[j].length>7){BioBLESS.navigation.button[j].title.scale.x*=7/BioBLESS.plugins[j].length;BioBLESS.navigation.button[j].title.scale.y*=7/BioBLESS.plugins[j].length}BioBLESS.navigation.button[j].title.position.x=60;BioBLESS.navigation.button[j].title.position.y=60+i*120;BioBLESS.navigation.button[j].t=BioBLESS.plugins[j];BioBLESS.navigation.button[j].on("mousedown",function(){BioBLESS.change_stage(BioBLESS[this.t])})}BioBLESS.navigation.down=new PIXI.Graphics;BioBLESS.navigation.down.interactive=true;BioBLESS.navigation.down.buttonMode=true;BioBLESS.navigation.up=new PIXI.Graphics;BioBLESS.navigation.up.interactive=false;BioBLESS.navigation.up.buttonMode=false;BioBLESS.navigation.up.alpha=0;BioBLESS.navigation.down.lineStyle(0);BioBLESS.navigation.up.lineStyle(0);BioBLESS.navigation.down.beginFill(16777215);BioBLESS.navigation.down.moveTo(40,this.navigation.h-30);BioBLESS.navigation.down.lineTo(80,this.navigation.h-30);BioBLESS.navigation.down.lineTo(60,this.navigation.h-10);BioBLESS.navigation.down.endFill();BioBLESS.navigation.up.beginFill(16777215);BioBLESS.navigation.up.moveTo(40,this.navigation.h-10);BioBLESS.navigation.up.lineTo(80,this.navigation.h-10);BioBLESS.navigation.up.lineTo(60,this.navigation.h-30);BioBLESS.navigation.up.endFill();var that=BioBLESS;BioBLESS.navigation.down.on("mousedown",function(){if(BioBLESS.navigation.condition==0){BioBLESS.navigation.down.interactive=false;BioBLESS.navigation.down.buttonMode=false;BioBLESS.navigation.up.interactive=true;BioBLESS.navigation.up.buttonMode=true;BioBLESS.navigation.condition=-1;for(var j=0;j<BioBLESS.navigation.button.length;j++){BioBLESS.navigation.button[j].interactive=true;BioBLESS.navigation.button[j].buttonMode=true}}});BioBLESS.navigation.up.on("mousedown",function(){if(BioBLESS.navigation.condition==0){BioBLESS.navigation.down.interactive=true;BioBLESS.navigation.down.buttonMode=true;BioBLESS.navigation.up.interactive=false;BioBLESS.navigation.up.buttonMode=false;BioBLESS.navigation.condition=1;for(var j=0;j<BioBLESS.navigation.button.length;j++){BioBLESS.navigation.button[j].interactive=false;BioBLESS.navigation.button[j].buttonMode=false}}});BioBLESS.animation[BioBLESS.animation.length]=function(){if(BioBLESS.navigation.condition==1){if(Math.abs(BioBLESS.navigation.position.y-BioBLESS.navigation.start_y)>1){BioBLESS.navigation.position.y-=(BioBLESS.navigation.position.y-BioBLESS.navigation.start_y)*.15;BioBLESS.navigation.up.alpha*=.85;BioBLESS.navigation.down.alpha=1-BioBLESS.navigation.up.alpha}else{BioBLESS.navigation.position.y=BioBLESS.navigation.start_y;BioBLESS.navigation.condition=0;BioBLESS.navigation.down.alpha=1;BioBLESS.navigation.up.alpha=0}}else if(BioBLESS.navigation.condition==-1){if(Math.abs(BioBLESS.navigation.position.y)>1){BioBLESS.navigation.position.y*=.85;BioBLESS.navigation.down.alpha*=.85;BioBLESS.navigation.up.alpha=1-BioBLESS.navigation.down.alpha}else{BioBLESS.navigation.position.y=0;BioBLESS.navigation.condition=0;BioBLESS.navigation.down.alpha=0;BioBLESS.navigation.up.alpha=1}}};this.navigation.addChild(background);this.navigation.addChild(this.navigation.up);this.navigation.addChild(this.navigation.down);for(var i=0;i<BioBLESS.navigation.button.length;i++){this.navigation.addChild(BioBLESS.navigation.button[i]);this.navigation.addChild(BioBLESS.navigation.button[i].title)}this.navigation.position.y-=this.navigation.h-160;this.navigation.start_y=this.navigation.position.y;this.navigation_title=new PIXI.Container;var background2=new PIXI.Graphics;background2.beginFill(0,1);background2.lineStyle(0);background2.drawRect(0,0,120,120);background2.endFill();background2.lineStyle(3,16777215,1);background2.drawCircle(60,60,50);var title=new PIXI.Text("BioBLESS",{fill:"#ffffff"});title.position.y=45;title.position.x=13;this.navigation_title.addChild(background2);this.navigation_title.addChild(title)};BioBLESS.init=function(){BioBLESS.width=$("body").width();BioBLESS.height=$("body").height();BioBLESS.stage=new PIXI.Container;var canvas=document.getElementById("canvas");var renderer=PIXI.autoDetectRenderer(BioBLESS.width,BioBLESS.height,{antialias:true,backgroundColor:11259375});if(!renderer)return;document.body.appendChild(renderer.view);var prev_time=0;var fps=0;var render=requestAnimationFrame;var animate=function(now){renderer.render(BioBLESS.stage);fps=Math.floor(1e3/(now-prev_time));prev_time=now;for(var i=0;i<BioBLESS.animation.length;i++)BioBLESS.animation[i]();render(animate)};render(animate);var next=function(){if(BioBLESS.home){BioBLESS.stage.addChild(BioBLESS.home.stage);BioBLESS.plugin_stage=BioBLESS.home.stage}else setTimeout(next,50)};setInterval(function(){var fps_obj=new PIXI.Text("FPS: "+fps);fps_obj.x=150;fps_obj.y=30;BioBLESS.stage.removeChild(BioBLESS.stage.fps);BioBLESS.stage.fps=fps_obj;BioBLESS.stage.addChild(fps_obj)},1e3);setTimeout(next,1);onDragStart_d=function(event){if(!BioBLESS.get_current_plugin_stage())return;this.data=event.data;this.dragging=true;var startPosition=this.data.getLocalPosition(this.parent);this.startX=startPosition.x;this.startY=startPosition.y;BioBLESS.get_current_plugin_stage().movable_stage.startX=BioBLESS.get_current_plugin_stage().movable_stage.position.x;BioBLESS.get_current_plugin_stage().movable_stage.startY=BioBLESS.get_current_plugin_stage().movable_stage.position.y};onDragEnd_d=function(){this.dragging=false;this.data=null};onDragMove_d=function(event){if(!BioBLESS.get_current_plugin_stage())return;if(this.dragging){var newPosition=this.data.getLocalPosition(this.parent);BioBLESS.get_current_plugin_stage().movable_stage.position.x=newPosition.x-this.startX+BioBLESS.get_current_plugin_stage().movable_stage.startX;BioBLESS.get_current_plugin_stage().movable_stage.position.y=newPosition.y-this.startY+BioBLESS.get_current_plugin_stage().movable_stage.startY}BioBLESS.get_current_plugin_stage().movable_stage.inPosition=event.data.getLocalPosition(BioBLESS.get_current_plugin_stage().movable_stage)};var dragArea=new PIXI.Graphics;dragArea.beginFill(0,0);dragArea.drawRect(0,0,65536,65536);dragArea.interactive=true;dragArea.on("mousedown",onDragStart_d).on("touchstart",onDragStart_d).on("mouseup",onDragEnd_d).on("mouseupoutside",onDragEnd_d).on("touchend",onDragEnd_d).on("touchendoutside",onDragEnd_d).on("mousemove",onDragMove_d).on("touchmove",onDragMove_d);BioBLESS.stage.addChild(dragArea);var scrollFunc=function(e){var d=0;e=e||window.event;if(e.wheelDelta){d=e.wheelDelta}else if(e.detail){d=e.detail}if(BioBLESS.get_current_plugin_stage()==null)return;if(d>0){if(BioBLESS.get_current_plugin_stage().movable_stage._scale>3)return;BioBLESS.get_current_plugin_stage().movable_stage._scale*=1.1}else{if(BioBLESS.get_current_plugin_stage().movable_stage._scale<.1)return;BioBLESS.get_current_plugin_stage().movable_stage._scale/=1.1}};if(document.addEventListener){document.addEventListener("DOMMouseScroll",scrollFunc,false)}window.onmousewheel=document.onmousewheel=scrollFunc;BioBLESS.prepare_navigation();BioBLESS.stage.addChild(BioBLESS.navigation);BioBLESS.stage.addChild(BioBLESS.navigation_title)};BioBLESS.change_stage=function(plugin){var child_stage=BioBLESS.get_current_plugin_stage();if(!child_stage)return;BioBLESS.stage.removeChild(child_stage);BioBLESS.stage.addChild(plugin.stage);BioBLESS.stage.addChild(BioBLESS.navigation);BioBLESS.stage.addChild(BioBLESS.navigation_title);BioBLESS.plugin_stage=plugin.stage};BioBLESS.home=new function(){this.stage=new PIXI.Container;this.stage.movable_stage=new PIXI.Container;this.stage.movable_stage._scale=1;this.DrawGate=function(icon){var graphics=new PIXI.Graphics;switch(icon){default:graphics.lineStyle(3,0,1);graphics.moveTo(0,25);graphics.lineTo(30,25);graphics.moveTo(0,45);graphics.lineTo(30,45);graphics.moveTo(120,35);graphics.lineTo(150,35);graphics.beginFill(0,0);graphics.drawRect(30,0,90,70);graphics.endFill();break}return graphics};this.draw=function(devices){this.stage.movable_stage._scale=1;var w=BioBLESS.width;var h=BioBLESS.height;var that=this;var elements=new Array;var waitForDoubleClick=false;that.onDragStart_e=function(event){if(waitForDoubleClick){var a=$.getJSON("/misc/devices.json");var that=this;var next=function(){if(a.responseJSON){BioBLESS.device.draw(a.responseJSON,that.Index);BioBLESS.change_stage(BioBLESS.device)}else setTimeout(next,50)};setTimeout(next,50);return}else{waitForDoubleClick=true;setTimeout(function(){waitForDoubleClick=false},500)}this.data=event.data;this.alpha=.5;this.dragging=true};that.onDragEnd_e=function(){this.alpha=1;this.dragging=false;this.data=null};that.onDragMove_e=function(){if(this.dragging){var newPosition=this.data.getLocalPosition(this.parent);this.position.x=newPosition.x-75;this.position.y=newPosition.y-35}};that.onDragStart=function(event){this.data=event.data;this.alpha=.5;this.dragging=true;this.startX=this.position.x;this.startY=this.position.y};that.onDragEnd=function(){this.alpha=1;this.dragging=false;this.data=null;if(!(this.position.x+75>=w-220&&this.position.x+75<=w-20&&this.position.y>=110&&this.position.y<=h-20)){elements[elements.length]=that.DrawGate(devices[this.Index].icon);elements[elements.length-1].position.x=this.childPosition.x-75;elements[elements.length-1].position.y=this.childPosition.y-35;elements[elements.length-1].interactive=true;elements[elements.length-1].buttonMode=true;elements[elements.length-1].Index=this.Index;elements[elements.length-1].on("mousedown",that.onDragStart_e).on("touchstart",that.onDragStart_e).on("mouseup",that.onDragEnd_e).on("mouseupoutside",that.onDragEnd_e).on("touchend",that.onDragEnd_e).on("touchendoutside",that.onDragEnd_e).on("mousemove",that.onDragMove_e).on("touchmove",that.onDragMove_e);that.stage.movable_stage.addChild(elements[elements.length-1])}this.position.x=this.startX;this.position.y=this.startY};that.onDragMove=function(){if(this.dragging){var newPosition=this.data.getLocalPosition(this.parent);this.position.x=newPosition.x-75;this.position.y=newPosition.y-35;this.childPosition=this.data.getLocalPosition(that.stage.movable_stage)}};that._logicGates=new Array;that.logicGates=new Array;for(var i=0;i<devices.length;i++){that._logicGates[i]=this.DrawGate(devices[i].icon);that.logicGates[i]=this.DrawGate(devices[i].icon);that._logicGates[i].position.x=w-195;that._logicGates[i].position.y=140+i*100;that.logicGates[i].position.x=w-195;that.logicGates[i].position.y=140+i*100;that.logicGates[i].interactive=true;that.logicGates[i].buttonMode=true;that.logicGates[i].Index=i;that.logicGates[i].on("mousedown",that.onDragStart).on("touchstart",that.onDragStart).on("mouseup",that.onDragEnd).on("mouseupoutside",that.onDragEnd).on("touchend",that.onDragEnd).on("touchendoutside",that.onDragEnd).on("mousemove",that.onDragMove).on("touchmove",that.onDragMove)}that.plusobj=new PIXI.Graphics;that.plusobj.beginFill(1193046,.5);that.plusobj.drawCircle(w-60,50,30);that.plusobj.endFill();that.plusobj.lineStyle(3,16776960,1);that.plusobj.moveTo(w-75,50);that.plusobj.lineTo(w-45,50);that.plusobj.moveTo(w-60,35);that.plusobj.lineTo(w-60,65);that.plusobj.interactive=true;that.plusobj.buttonMode=true;that.list=new PIXI.Graphics;that.list.beginFill(9009303,.5);that.list.drawRoundedRect(w-220,110,200,h-130,20);that.list.endFill();var added=false;that.plusobj.on("mousedown",function(){if(added){that.stage.removeChild(that.list);for(var i=0;i<devices.length;i++){that.stage.removeChild(that._logicGates[i]);that.stage.removeChild(that.logicGates[i])}}else{that.stage.addChild(that.list);for(var i=0;i<devices.length;i++){that.stage.addChild(that._logicGates[i]);that.stage.addChild(that.logicGates[i])}}added=!added});this.stage.addChild(this.stage.movable_stage);this.stage.addChild(that.plusobj);return this.stage};var a=$.getJSON("../misc/devices.json");setTimeout(function(){BioBLESS.home.draw(a.responseJSON)},100);return this};BioBLESS.device=new function(){this.stage=new PIXI.Container;this.stage.movable_stage=new PIXI.Container;this.stage.movable_stage._scale=1;this.prepare=function(devices,n){this.lines_num=devices[n].lines.id.length;this.parts_num=0;this.part_to_line=new Array;this.to_part=new Array;this.is_dna=new Array;for(i=0;i<this.lines_num;i++){this.to_part[i]=new Array;this.is_dna[i]=new Array;for(j=0;j<devices[n].lines.id[i].length;j++){this.part_to_line[this.parts_num+j]=i;this.to_part[i][j]=this.parts_num+j;this.is_dna[i][j]=false}this.parts_num=this.parts_num+devices[n].lines.id[i].length}for(i=0;i<devices[n].map.length;i++){if(devices[n].map[i].id1[0]=="d"){this.is_dna[this.part_to_line[parseInt(devices[n].map[i].id1.substring(1))-1]][parseInt(devices[n].map[i].id1.substring(1))-1]=true}}};this.line_analysis=function(devices,n){var i,j,k,l,Num,s;this.is_line=new Array;this.line_type=new Array;for(i=0;i<this.parts_num;i++){this.is_line[i]=new Array;this.line_type[i]=new Array;for(j=0;j<this.parts_num;j++){this.is_line[i][j]=false;this.line_type[i][j]=null}}Num=0;for(i=0;i<this.lines_num;i++){for(j=0;j<devices[n].lines.id[i].length;j++){if(this.is_dna[i][j]){var end=-1;for(k=0;k<devices[n].map.length;k++){if(devices[n].map[k].id1[0]=="d"&&parseInt(devices[n].map[k].id1.substring(1))-1==this.to_part[i][j]){for(l=0;l<devices[n].map.length;l++){if(devices[n].map[l].id1==devices[n].map[k].id2){end=parseInt(devices[n].map[l].id2.substring(1))-1;s=devices[n].map[l].type}}}}if(end==-1){alert("Error!");return}this.is_line[Num+j][end]=true;this.line_type[Num+j][end]=s}}Num=Num+this.lines_num}};this.height_analysis=function(devices,n){var i,j,k,l,Num,s;this.protein_height=new Array(this.parts_num);for(i=0;i<this.parts_num;i++)this.protein_height[i]=0;for(Num=1;Num<this.parts_num;Num++){for(i=0;i<this.parts_num-Num;i++){j=i+Num;if(this.is_line[i][j]){if(this.part_to_line[i]==this.part_to_line[j]){this.protein_height[i]+=1;for(k=0;k<i;k++){for(l=i;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[k]+=1;if(this.is_line[l][k]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[l]+=1}}for(k=i;k<=j;k++){for(l=j+1;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[k]+=1;if(this.is_line[l][k]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[l]+=1}}if(this.is_line[j][i])this.protein_height[j]+=1}else{this.protein_height[i]-=1;for(k=0;k<i;k++){for(l=i;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[k]-=1;if(this.is_line[l][k]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[l]-=1}}for(k=i;k<=j;k++){for(l=j+1;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[k]-=1;if(this.is_line[l][k]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[l]-=1}}if(this.is_line[j][i])this.protein_height[j]-=1}}if(this.is_line[j][i]){if(this.part_to_line[i]==this.part_to_line[j]){this.protein_height[j]+=1;for(k=0;k<i;k++){for(l=i;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[k]+=1;if(this.is_line[l][k]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[l]+=1}}for(k=i;k<=j;k++){for(l=j+1;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[k]+=1;if(this.is_line[l][k]&&this.part_to_line[k]==this.part_to_line[l])this.protein_height[l]+=1}}}else{this.protein_height[j]-=1;for(k=0;k<i;k++){for(l=i;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[k]-=1;if(this.is_line[l][k]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[l]-=1}}for(k=i;k<=j;k++){for(l=j+1;l<this.parts_num;l++){if(this.is_line[k][l]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[k]-=1;if(this.is_line[l][k]&&this.part_to_line[k]!=this.part_to_line[l])this.protein_height[l]-=1}}}}}}this.protein_heightest=0,this.protein_lowest=0;for(i=0;i<this.parts_num;i++){if(this.protein_height[i]>this.protein_heightest)this.protein_heightest=this.protein_height[i];if(this.protein_height[i]<this.protein_lowest)this.protein_lowest=this.protein_height[i]}};this.part_analysis=function(devices,n){var i,j,k,l,Num,s;this.part=new Array;for(i=0;i<this.parts_num;i++){this.part[i]=function(){};this.part[i].upIndegree=0;this.part[i].upOutdegree=0;this.part[i].downIndegree=0;this.part[i].downOutdegree=0;this.part[i].upLine=0;this.part[i].downLine=0;for(j=0;j<this.parts_num;j++){if(this.part_to_line[i]==this.part_to_line[j]){if(this.is_line[i][j])this.part[i].upOutdegree+=1;if(this.is_line[j][i])this.part[i].upIndegree+=1}else{if(this.is_line[i][j])this.part[i].downOutdegree+=1;if(this.is_line[j][i])this.part[i].downIndegree+=1}}}};this.draw=function(devices,n){this.stage.movable_stage._scale=1;var w=BioBLESS.width;if(!devices[n]){alert("Error!");return}this.prepare(devices,n);this.line_analysis(devices,n);this.height_analysis(devices,n);this.part_analysis(devices,n);var i,j,k,l,Num,s;var nodeH=40,nodeW=130,nodeDis=180,floorDis=120;var stageH=floorDis*(this.protein_heightest-this.protein_lowest+4);var stageW=nodeDis*(this.parts_num+3);if(stageH<$("body").height())stageH=$("body").height();if(stageW<$("body").width())stageW=$("body").width();var texture=PIXI.Texture.fromImage("/misc/test.png");var parts=new Array;var BBAs=new Array;for(i=0;i<devices[n].posloc.length;i++){BBAs[this.to_part[devices[n].posloc[i].l1][parseInt(devices[n].posloc[i].from.substring(1))-1]]=new PIXI.Graphics}var graphics=new PIXI.Graphics;graphics.lineStyle(10,65365,1);Num=0;for(i=0;i<this.lines_num;i++){graphics.moveTo((this.to_part[i][0]+i+1)*nodeDis-40,stageH/2);for(j=0;j<devices[n].lines.id[i].length;j++){parts[this.to_part[i][j]]=new PIXI.Sprite(texture);parts[this.to_part[i][j]].position.y=(stageH-nodeH)/2;parts[this.to_part[i][j]].position.x=(this.to_part[i][j]+i+1)*nodeDis;if(BBAs[this.to_part[i][j]]){BBAs[this.to_part[i][j]].lineStyle(0);BBAs[this.to_part[i][j]].beginFill(65535);BBAs[this.to_part[i][j]].drawRect(parts[this.to_part[i][j]].position.x+nodeW,stageH/2-5,50,10);BBAs[this.to_part[i][j]].endFill();BBAs[this.to_part[i][j]].interactive=true;BBAs[this.to_part[i][j]].buttonMode=true;BBAs[this.to_part[i][j]].on("mousedown",function(){alert("")})}}Num+=devices[n].lines.id[i].length;graphics.lineTo((Num+i+1)*nodeDis,stageH/2);graphics.moveTo((Num+i+1)*nodeDis,stageH/2);graphics.lineTo((Num+i+1)*nodeDis-11,stageH/2-8);graphics.lineTo((Num+i+1)*nodeDis-11,stageH/2+8)}graphics.lineStyle(6,16724736,1);for(i=0;i<this.parts_num;i++){for(j=0;j<this.parts_num;j++){if(this.is_line[i][j]){parts[i].protein=new PIXI.Sprite(texture);parts[i].protein.position.x=parts[i].position.x;parts[i].protein.position.y=parts[i].position.y-this.protein_height[i]*floorDis;if(this.protein_height[i]>0){this.part[i].upLine++;this.part[j].upLine++;k=nodeW/(this.part[i].upIndegree+this.part[i].upOutdegree+1);l=nodeW/(this.part[j].upIndegree+this.part[j].upOutdegree+1);graphics.moveTo(parts[i].position.x+k*this.part[i].upLine,parts[i].position.y);graphics.lineTo(parts[i].position.x+k*this.part[i].upLine,parts[i].protein.position.y+nodeH+5);graphics.moveTo(parts[i].position.x+k*this.part[i].upLine,parts[i].protein.position.y+nodeH+5);graphics.lineTo(parts[i].position.x+k*this.part[i].upLine-8,parts[i].protein.position.y+nodeH+15);graphics.lineTo(parts[i].position.x+k*this.part[i].upLine+8,parts[i].protein.position.y+nodeH+15);graphics.moveTo(parts[i].protein.position.x+nodeW,parts[i].protein.position.y+nodeH/2);graphics.lineTo(parts[j].position.x+l*this.part[j].upLine,parts[i].protein.position.y+nodeH/2);graphics.moveTo(parts[j].position.x+l*this.part[j].upLine,parts[i].protein.position.y+nodeH/2-3);graphics.lineTo(parts[j].position.x+l*this.part[j].upLine,parts[j].position.y-8);if(this.line_type[i][j]=="inh"){graphics.moveTo(parts[j].position.x+l*this.part[j].upLine-10,parts[j].position.y-7);graphics.lineTo(parts[j].position.x+l*this.part[j].upLine+10,parts[j].position.y-7)}else{graphics.moveTo(parts[j].position.x+l*this.part[j].upLine,parts[j].position.y-5);graphics.lineTo(parts[j].position.x+l*this.part[j].upLine+8,parts[j].position.y-15);graphics.lineTo(parts[j].position.x+l*this.part[j].upLine-8,parts[j].position.y-15)}}else{this.part[i].downLine++;this.part[j].downLine++;k=nodeW/(this.part[i].downIndegree+this.part[i].downOutdegree+1);l=nodeW/(this.part[j].downIndegree+this.part[j].downOutdegree+1);graphics.moveTo(parts[i].position.x+k*this.part[i].downLine,parts[i].position.y+nodeH);graphics.lineTo(parts[i].position.x+k*this.part[i].downLine,parts[i].protein.position.y-5);graphics.moveTo(parts[i].position.x+k*this.part[i].downLine,parts[i].protein.position.y-5);graphics.lineTo(parts[i].position.x+k*this.part[i].downLine-8,parts[i].protein.position.y-15);graphics.lineTo(parts[i].position.x+k*this.part[i].downLine+8,parts[i].protein.position.y-15);graphics.moveTo(parts[i].protein.position.x+nodeW,parts[i].protein.position.y+nodeH/2);graphics.lineTo(parts[j].position.x+l*this.part[j].downLine,parts[i].protein.position.y+nodeH/2);graphics.moveTo(parts[j].position.x+l*this.part[j].downLine,parts[i].protein.position.y+nodeH/2+3);graphics.lineTo(parts[j].position.x+l*this.part[j].downLine,parts[j].position.y+nodeH+8);if(this.line_type[i][j]=="inh"){graphics.moveTo(parts[j].position.x+l*this.part[j].downLine-10,parts[j].position.y+nodeH+7);graphics.lineTo(parts[j].position.x+l*this.part[j].downLine+10,parts[j].position.y+nodeH+7)}else{graphics.moveTo(parts[j].position.x+l*this.part[j].downLine,parts[j].position.y+nodeH+5);graphics.lineTo(parts[j].position.x+l*this.part[j].downLine+8,parts[j].position.y+nodeH+15);graphics.lineTo(parts[j].position.x+l*this.part[j].downLine-8,parts[j].position.y+nodeH+15)}}}}}for(i=0;i<devices[n].map.length;i++){if(devices[n].map[i].id2[0]=="e"){Num=parseInt(devices[n].map[i].id2.substring(1))-1;k=parseInt(devices[n].map[Num].id1.substring(1))-1;l=parseInt(devices[n].map[Num].id2.substring(1))-1;if(k<l){graphics.moveTo(parts[k].protein.position.x+nodeW+25,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x+nodeW+25,parts[k].protein.position.y+nodeH/2+40);if(devices[n].map[i].type=="inh"){graphics.moveTo(parts[k].protein.position.x+nodeW+33,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x+nodeW+17,parts[k].protein.position.y+nodeH/2+8)}else{graphics.moveTo(parts[k].protein.position.x+nodeW+25,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x+nodeW+17,parts[k].protein.position.y+nodeH/2+18);graphics.lineTo(parts[k].protein.position.x+nodeW+33,parts[k].protein.position.y+nodeH/2+18)}parts[k].protein.Text=new PIXI.Text(devices[n].map[i].id1);parts[k].protein.Text.position.x=parts[k].protein.position.x+nodeW;parts[k].protein.Text.position.y=parts[k].protein.position.y+nodeH/2+40}else{graphics.moveTo(parts[k].protein.position.x-25,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x-25,parts[k].protein.position.y+nodeH/2+40);if(devices[n].map[i].type=="inh"){graphics.moveTo(parts[k].protein.position.x-17,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x-33,parts[k].protein.position.y+nodeH/2+8)}else{graphics.moveTo(parts[k].protein.position.x-25,parts[k].protein.position.y+nodeH/2+8);graphics.lineTo(parts[k].protein.position.x-17,parts[k].protein.position.y+nodeH/2+18);graphics.lineTo(parts[k].protein.position.x-33,parts[k].protein.position.y+nodeH/2+18)}parts[k].protein.Text=new PIXI.Text(devices[n].map[i].id1);parts[k].protein.Text.position.x=parts[k].protein.position.x-50;parts[k].protein.Text.position.y=parts[k].protein.position.y+nodeH/2+40}}}this.stage.movable_stage.addChild(graphics);for(i=0;i<this.parts_num;i++){if(BBAs[i])this.stage.movable_stage.addChild(BBAs[i]);this.stage.movable_stage.addChild(parts[i]);if(parts[i].protein){this.stage.movable_stage.addChild(parts[i].protein);if(parts[i].protein.Text){this.stage.movable_stage.addChild(parts[i].protein.Text)}}}var moveX=w/2-(this.parts_num+this.lines_num+1)*90+25;if(moveX>0)this.stage.movable_stage.position.x=moveX;this.stage.addChild(this.stage.movable_stage);return this.stage}};BioBLESS.simulator=new function(){this.stage=new PIXI.Container;this.stage.movable_stage=new PIXI.Container;this.stage.movable_stage._scale=1;this.draw=function(_nodes){this.stage.movable_stage._scale=1;var nodes=function(){};nodes.t=_nodes.t;nodes.c=new Array;nodes.names=new Array;var i=0;for(var o in _nodes){if(o!="t"){nodes.c[i]=_nodes[o];nodes.names[i]=o;i++}}var xAxis=1100,yAxis=600;var ox=350,oy=800;graphics=new PIXI.Graphics;graphics.lineStyle(2,0,1);graphics.moveTo(ox,oy);graphics.lineTo(ox+xAxis,oy);graphics.moveTo(ox,oy+1);graphics.lineTo(ox,oy-yAxis);var maxY=0;for(var i=0;i<nodes.c.length;i++){if(maxY<nodes.c[i][nodes.c[i].length-1]){maxY=nodes.c[i][nodes.c[i].length-1]}}var xDis=0,yDis=0;xDis=nodes.t[nodes.t.length-1]/25;var dis1=function(x){if(x>=10){return dis1(x/10)*10}else{if(x<1.5){return 1}x/=2;return(parseInt(x)+(x-parseInt(x)>=.5?1:0))*2}};var dis2=function(x){if(x<=1){return dis2(x*10)/10}else{if(x<1.5){return 1}x/=2;return(parseInt(x)+(x-parseInt(x)>=.5?1:0))*2}};if(xDis>5){xDis=dis1(xDis)*5}else if(xDis<5){xDis=dis2(xDis)*5}yDis=maxY/35;if(yDis>5){yDis=dis1(yDis)*5}else if(xDis<5){yDis=dis2(yDis)*5}ox+=20;oy-=20;var i=0,d=(xAxis-50)/nodes.t[nodes.t.length-1]*xDis/5;while(i*d<xAxis-50){graphics.moveTo(ox+i*d,oy+20);graphics.lineTo(ox+i*d,oy+13-(i%5?0:7));if(!(i%5)){var Text=new PIXI.Text((i/5*xDis).toString());Text.position.x=ox+i*d-(i/5*yDis).toString().length*8;Text.position.y=oy+20;this.stage.movable_stage.addChild(Text)}i++}var i=0,d=(yAxis-100)/maxY*yDis/5;while(i*d<yAxis-50){graphics.moveTo(ox-20,oy-i*d);graphics.lineTo(ox-13+(i%5?0:7),oy-i*d);if(!(i%5)){var Text=new PIXI.Text((i/5*yDis).toString());Text.position.x=ox-20-(i/5*yDis).toString().length*16;Text.position.y=oy-i*d-14;this.stage.movable_stage.addChild(Text)}i++}var _color,gray=0,red,green,blue;for(var i=0;i<nodes.c.length;i++){gray=255;while(gray>155||gray<100){red=parseInt(Math.random()*255);green=parseInt(Math.random()*255);blue=parseInt(Math.random()*255);gray=.3*red+.6*green+.1*blue}_color=red*65536+green*256+blue;graphics.lineStyle(2,_color,1);graphics.moveTo(ox+(xAxis-50)/nodes.t[nodes.t.length-1]*nodes.t[0],oy-(yAxis-100)*nodes.c[i][0]/maxY);for(var j=1;j<nodes.t.length;j++){graphics.lineTo(ox+(xAxis-50)/nodes.t[nodes.t.length-1]*nodes.t[j],oy-(yAxis-100)*nodes.c[i][j]/maxY);graphics.moveTo(ox+(xAxis-50)/nodes.t[nodes.t.length-1]*nodes.t[j],oy-(yAxis-100)*nodes.c[i][j]/maxY)}graphics.moveTo(ox+xAxis+80,oy-yAxis+100+i*70);graphics.lineTo(ox+xAxis+220,oy-yAxis+100+i*70);var Text=new PIXI.Text(nodes.names[i],{fill:"#"+_color.toString(16)});Text.position.x=ox+xAxis+240;Text.position.y=oy-yAxis+82+i*70;this.stage.movable_stage.addChild(Text)}this.stage.movable_stage.addChild(graphics);this.stage.addChild(this.stage.movable_stage);return this.stage};var b=$.getJSON("../misc/simulator.json");setTimeout(function(){BioBLESS.simulator.draw(b.responseJSON)},100)};BioBLESS.IDdraw=function(){};BioBLESS.IDdraw.drawElement=function(icon){var graphics=new PIXI.Graphics;graphics.lineStyle(3,0,1);switch(icon){case"00000167":graphics.moveTo(31.5,11.5);graphics.lineTo(40,23);graphics.lineTo(31.5,30.3333);graphics.moveTo(10,50);graphics.lineTo(10,23);graphics.lineTo(39,23);break;case"00000057":graphics.drawRect(15,40,20,20);break;case"00000316":graphics.moveTo(9,65);graphics.lineTo(27,65);graphics.lineTo(42,50);graphics.lineTo(27,35);graphics.lineTo(9,35);graphics.lineTo(9,65);break;case"00000139":graphics.moveTo(12,45);graphics.lineTo(12,50);graphics.lineTo(38,50);graphics.lineTo(38,45);graphics.bezierCurveTo(38,35,32,30,25,30);graphics.bezierCurveTo(18,30,12,35,12,45);break;case"00000141":graphics.moveTo(25,50);graphics.lineTo(25,26);graphics.moveTo(10,25);graphics.lineTo(40,25);break;case"00000627":graphics.drawRect(17,42,16,16);graphics.drawRect(10,35,30,30);break;case"10000001":graphics.moveTo(25,50);graphics.lineTo(25,45);graphics.moveTo(25,38);graphics.lineTo(25,33);graphics.moveTo(17,16);graphics.lineTo(33,32);graphics.moveTo(33,16);graphics.lineTo(17,32);break;case"00001957":graphics.moveTo(25,50);graphics.lineTo(25,46);graphics.moveTo(25,41);graphics.lineTo(25,37);graphics.drawCircle(25,25,7);break;case"00001956":graphics.moveTo(25,50);graphics.lineTo(25,25);graphics.moveTo(17,16);graphics.lineTo(33,32);graphics.moveTo(33,16);graphics.lineTo(17,32);break;case"00001955":graphics.moveTo(25,50);graphics.lineTo(25,34);graphics.drawCircle(25,25,7);break;case"00000296":graphics.drawCircle(25,50,12);break;case"00005850":graphics.moveTo(12,45);graphics.lineTo(38,45);graphics.lineTo(28,38);break;case"00001687":graphics.moveTo(25,37);graphics.lineTo(25,63);break;case"00001691":graphics.moveTo(31,37);graphics.lineTo(28,37);graphics.lineTo(28,63);graphics.lineTo(31,63);graphics.moveTo(19,37);graphics.lineTo(22,37);graphics.lineTo(22,63);graphics.lineTo(19,63);break;case"10000002":graphics.moveTo(10,37);graphics.lineTo(10,50);graphics.lineTo(40,50);graphics.lineTo(40,63);break;case"10000003":graphics.moveTo(40,37);graphics.lineTo(40,50);graphics.lineTo(10,50);graphics.lineTo(10,63);break;case"00001933":graphics.moveTo(10,46);graphics.lineTo(40,46);graphics.moveTo(25,54);
graphics.lineTo(40,54);break;case"00001932":graphics.moveTo(10,46);graphics.lineTo(40,46);graphics.moveTo(25,54);graphics.lineTo(10,54);break;case"00001953":graphics.moveTo(13,46);graphics.lineTo(17,46);graphics.moveTo(13,54);graphics.lineTo(37,54);break;case"10000004":graphics.drawRect(5,20,40,25);graphics.moveTo(10,27);graphics.lineTo(20,37);graphics.moveTo(10,37);graphics.lineTo(20,27);graphics.moveTo(24,39);graphics.lineTo(40,39);break;case"10000000":graphics.drawRect(5,20,40,25);break}return graphics};BioBLESS.IDdraw.Create=function(devices,w,h){var onDragStart=function(event){this.data=event.data;this.alpha=.5;this.dragging=true;this.startX=this.position.x;this.startY=this.position.y};var onDragEnd=function(){this.alpha=1;this.dragging=false;this.data=null;his.position.x=this.startX;this.position.y=this.startY};var onDragMove=function(){if(this.dragging){var newPosition=this.data.getLocalPosition(this.parent);this.position.x=newPosition.x-75;this.position.y=newPosition.y-35;this.childPosition=this.data.getLocalPosition(that.childStage)}};this.stage=new PIXI.Container;that._SBOL=new Array;that.SBOL=new Array;for(var i=0;i<devices.length;i++){that._SBOL[i]=this.drawElement(devices[i].icon);that.SBOL[i]=this.drawElement(devices[i].icon);that._SBOL[i].position.x=w-195;that._SBOL[i].position.y=140+i*100;that.SBOL[i].position.x=w-195;that.SBOL[i].position.y=140+i*100;that.SBOL[i].interactive=true;that.SBOL[i].buttonMode=true;that.SBOL[i].Index=i;that.SBOL[i].on("mousedown",onDragStart).on("touchstart",onDragStart).on("mouseup",onDragEnd).on("mouseupoutside",onDragEnd).on("touchend",onDragEnd).on("touchendoutside",onDragEnd).on("mousemove",onDragMove).on("touchmove",onDragMove)}return this.stage};
