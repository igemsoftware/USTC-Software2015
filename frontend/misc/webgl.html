<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>标题</title>
    <!--link rel="stylesheet" href="" type="text/css"-->
    <script src="//code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script>
    <style type="text/css">
        @import url(//fonts.googleapis.com/css?family=Lora|Open+Sans|Inconsolata);
        body {
            margin: 0;
        }
        #main {
            font: 50px/80px 'Open Sans',Sans-Serif;
            text-align: center;
        }
        #warn {
            font: 20px/30px 'Lora',Serif;
            text-align: center;
        }
        #canvas {
            font: 20px/30px 'Lora',Serif;
            width: 100%;
            height: 400px;
            background: red;
        }
    </style>
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;
        void main() {
            gl_Position = vec4(a_position, 0, 1);
        }
    </script>
    <script id="2d-fragment-shader" type="x-shader/x-fragment">
        void main() {
            gl_FragColor = vec4(0, 1, 0, 1);
        }
    </script>
    <script type="text/javascript">
        var error = function(msg) {
            if (window.console) {
                if (window.console.error) {
                    window.console.error(msg);
                } else if (window.console.log) {
                    window.console.log(msg);
                }
            }
        };
        var loadShader = function(gl, shaderSource, shaderType, opt_errorCallback) {
            var errFn = opt_errorCallback || error;
            var shader = gl.createShader(shaderType);
            gl.shaderSource(shader, shaderSource);
            gl.compileShader(shader);
            var compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
            if (!compiled) {
                lastError = gl.getShaderInfoLog(shader);
                errFn("*** Error compiling shader '" + shader + "':" + lastError);
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        };
        var createProgram = function(gl, shaders, opt_attribs, opt_locations) {
            var program = gl.createProgram();
            for (var ii = 0; ii < shaders.length; ++ii) {
                gl.attachShader(program, shaders[ii]);
            }
            if (opt_attribs) {
                for (var ii = 0; ii < opt_attribs.length; ++ii) {
                    gl.bindAttribLocation(program, opt_locations? opt_locations[ii]: ii, opt_attribs[ii]);
                }
            }
            gl.linkProgram(program);
            var linked = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (!linked) {
                lastError = gl.getProgramInfoLog (program);
                error("Error in program linking:" + lastError);
                gl.deleteProgram(program);
                return null;
            }
            return program;
        };
        var createShaderFromScriptElement = function(gl, scriptId, opt_shaderType, opt_errorCallback) {
            var shaderSource = "";
            var shaderType;
            var shaderScript = document.getElementById(scriptId);
            if (!shaderScript) {
                throw("*** Error: unknown script element" + scriptId);
            }
            shaderSource = shaderScript.text;
            if (!opt_shaderType) {
                if (shaderScript.type == "x-shader/x-vertex") {
                    shaderType = gl.VERTEX_SHADER;
                } else if (shaderScript.type == "x-shader/x-fragment") {
                    shaderType = gl.FRAGMENT_SHADER;
                } else if (shaderType != gl.VERTEX_SHADER && shaderType != gl.FRAGMENT_SHADER) {
                    throw("*** Error: unknown shader type");
                    return null;
                }
            }
            return loadShader(gl, shaderSource, opt_shaderType? opt_shaderType: shaderType, opt_errorCallback);
        };
        var render = function(canvas, gl) {
            var vertexShader = createShaderFromScriptElement(gl, "2d-vertex-shader");
            var fragmentShader = createShaderFromScriptElement(gl, "2d-fragment-shader");
            var program = createProgram(gl, [vertexShader, fragmentShader]);
            gl.useProgram(program);
            var positionLocation = gl.getAttribLocation(program, "a_position");
            var buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(
                    gl.ARRAY_BUFFER,
                    new Float32Array([
                            -1.0, -1.0,
                            1.0, -1.0,
                            -1.0, 1.0,
                            -1.0, 1.0,
                            1.0, -1.0,
                            1.0,  1.0]),
                    gl.STATIC_DRAW);
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
            gl.drawArrays(gl.TRIANGLES, 0, 6);
        };
        $(document).ready(function() {
                canvas = document.getElementById("canvas");
                gl = null;
                warn = document.getElementById("warn");
                try {
                    gl = canvas.getContext("webgl");
                } catch(e) {
                }
                if(gl)
                    warn.style.display = "none";
                else {
                    try {
                        gl = canvas.getContext("experimental-webgl");
                    } catch(e) {
                    }
                    if(gl) {
                        warn.innerHTML = 'Your browser may not fully support WebGL, please consider to use the <a href="https://www.google.com/chrome/">latest Chrome</a>.';
                        warn.style.background = "yellow";
                    } else {
                        warn.innerHTML = 'Your browser does not support WebGL, please consider to use the <a href="https://www.google.com/chrome/">latest Chrome</a>.';
                        warn.style.background = "red";
                    }
                }
                if(gl)
                    render(canvas, gl);
            });
    </script>
</head>
<body>
    <h1 id="main">WebGL App Test</h1>
    <p id="warn">Please wait...</p>
    <canvas id="canvas">Your browser does not support canvas, please consider to use the <a href="https://www.google.com/chrome/">latest Chrome</a>.</canvas>
</body>
</html>
