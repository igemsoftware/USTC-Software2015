<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>USTC-Software 2015</title>
    <!-- jQuery URL: https://jquery.com/download/ License: MIT -->
    <script src="lib/jquery-2.1.4.min.js" type="text/javascript"></script>
    <!-- Pixi.js URL: https://github.com/GoodBoyDigital/pixi.js License: MIT -->
    <script src="lib/pixi-3.0.7.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora%7cOpen+Sans%7cInconsolata" type="text/css">
    <style type="text/css">
        html, body {
            height: 100%;
            overflow: hidden;
        }
        html, body, nav, canvas, nav p, nav ul, nav ul li {
            margin: 0;
        }
        nav {
            font: 24px/40px 'Open Sans',Sans-Serif;
            height: 60px;
            background-color: #222;
            text-align: center;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        nav p, nav ul li {
            float: left;
            list-style: none;
            padding: 10px 20px;
            cursor: pointer;
            color: #999;
        }
        nav p:hover, nav ul li:hover {
            color: #fff;
        }
        #fps {
            float: right;
        }
    </style>
    <script type="text/javascript">
        $(function() {
            renderer = PIXI.autoDetectRenderer($("body").width(), $("body").height() - $("nav").height(), {view : document.getElementById("canvas"), antialias : true, backgroundColor : 0xabcdef});
            if(!renderer)
                return;
            var stage = new PIXI.Container();
            // Test Code Below
            var texture = PIXI.Texture.fromImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAlCAYAAABcZvm2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWNJREFUeNrsV8sNwjAMbUqBBWACxB2pQ8AKcGALTsAJuDEFB1gBhuDAuWICmICPQh01pXWdJqEFcaglRGRbfonjPLuMc+5QwhjLGEJfZusjxZOL9akZKye9G98vPMfvsAx4qBfKwfzBL9s6uUHpI6U/u7+BKGkNb/H6umtk7MczF0HyfKS4zo/k/4AgTV8DOizrqX8oECgC+MGa8lGJp9sJDiAB8nyqYoglvJOPbP97IqoATGxWVZeXJlMQwYHA3piF8wJIblOVNBBxe3TPMLoHIKtxrbS7AAbBrA4Y5NaPAXf8LjN6wKZ0RaZOnlAFZnuXInVR4FTE6eYp0olPhhshtXsAwY3PquoAJNkIY33U7HTs7hYBwV24ItUKqDwgKF3VzAZ6k8HF+B1BMF8xRJbeJoqMXHZAAQ1kwoluURCdzepEugGEImBrIADB7I4lyfbJLlw92FKE6b5hVd+ktv4vAQYASMWxvlAAvcsAAAAASUVORK5CYII=");
            onDragStart = function(event) {
                this.data = event.data;
                this.alpha = 0.5;
                this.dragging = true;
            };
            onDragEnd = function() {
                this.alpha = 1;
                this.dragging = false;
                this.data = null;
            };
            onDragMove = function() {
                if(this.dragging) {
                    var newPosition = this.data.getLocalPosition(this.parent);
                    this.position.x = newPosition.x;
                    this.position.y = newPosition.y;
                }
            };
            createBunny = function(x, y) {
                var bunny = new PIXI.Sprite(texture);
                bunny.interactive = true;
                bunny.buttonMode = true;
                bunny.anchor.set(0.5);
                bunny.scale.set(3);
                bunny.on('mousedown', onDragStart)
                     .on('touchstart', onDragStart)
                     .on('mouseup', onDragEnd)
                     .on('mouseupoutside', onDragEnd)
                     .on('touchend', onDragEnd)
                     .on('touchendoutside', onDragEnd)
                     .on('mousemove', onDragMove)
                     .on('touchmove', onDragMove);
                bunny.position.x = x;
                bunny.position.y = y;
                stage.addChild(bunny);
            };
            for(var i = 0; i < 10; i++)
                createBunny(Math.floor(Math.random() * renderer.width), Math.floor(Math.random() * renderer.height));
            // Test Code Above
            var plusobj = new PIXI.Graphics();
            plusobj.beginFill(0x123456, 0.5);
            plusobj.drawCircle(renderer.width - 60, 50, 30);
            plusobj.endFill();
            plusobj.lineStyle(3, 0xffff00, 1);
            plusobj.moveTo(renderer.width - 75, 50);
            plusobj.lineTo(renderer.width - 45, 50);
            plusobj.moveTo(renderer.width - 60, 35);
            plusobj.lineTo(renderer.width - 60, 65);
            plusobj.interactive = true;
            plusobj.buttonMode = true;
            var list = new PIXI.Graphics();
            list.beginFill(0x897897, 0.5);
            list.drawRoundedRect(renderer.width - 220, 110, 200, renderer.height - 130, 20);
            list.endFill();
            var added = false;
            plusobj.on('mousedown', function() {
                    if(added)
                        stage.removeChild(list);
                    else
                        stage.addChild(list);
                    added = !added;
                });
            stage.addChild(plusobj);
            var prev = 0;
            var fps = 0;
            animate = function(now) {
                renderer.render(stage);
                fps = Math.floor(1000 / (now - prev));
                prev = now;
                requestAnimationFrame(animate);
            };
            requestAnimationFrame(animate);
            setInterval(function() {$("#fps").html("FPS: " + fps);}, 1000);

            device=$.ajax("plugins/device.js");
            home_stage = stage;
            $("#device").on("click", function(){eval(device.responseText);stage=main(renderer);});
            $("#home").on("click", function(){stage = home_stage;});
        });
    </script>
</head>
<body>
    <nav>
        <p>AppName</p>
        <ul>
            <li id="home">Home</li>
            <li id="device">Device</li>
            <li>Test2</li>
        </ul>
        <p id="fps">&nbsp;</p>
    </nav>
    <canvas id="canvas">Your browser does not support canvas, please consider to use <a href="https://www.google.com/chrome/">latest Chrome</a>.</canvas>
</body>
</html>
