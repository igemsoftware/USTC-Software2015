<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>USTC-Software 2015</title>
    <!-- jQuery URL: https://jquery.com/download/ License: MIT -->
    <script src="jquery-2.1.4.min.js" type="text/javascript"></script>
    <!-- Pixi.js URL: https://github.com/GoodBoyDigital/pixi.js License: MIT -->
    <script src="pixi-3.0.7.min.js" type="text/javascript"></script>
    <script src="homepage.js" type="text/javascript"></script>
    <script src="DevicesModule/devices.js" type="text/javascript"></script>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora%7cOpen+Sans%7cInconsolata" type="text/css">
    <style type="text/css">
        html, body {
            height: 100%;
            overflow: hidden;
        }
        html, body, nav, canvas, nav p, nav ul, nav ul li {
            margin: 0;
        }
        nav {
            font: 24px/40px 'Open Sans',Sans-Serif;
            height: 60px;
            background-color: #222;
            text-align: center;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        nav p, nav ul li {
            float: left;
            list-style: none;
            padding: 10px 20px;
            cursor: pointer;
            color: #999;
        }
        nav p:hover, nav ul li:hover {
            color: #fff;
        }
    </style>
    <script type="text/javascript">
	    $(function() {
			var Devices = 
			[{
			    'id': 0,
   			    'name': 'test',
  			    'icon':  'or',
				
  			    'type': 
				{
   			        'type': null,
   			        'function': '',
    			    'chassis':'',
  			        'standard':'',
  			        'contributor':''
  			    },
				
  			    'lines':
				{
   			        'id':[['d1', 'd2', 'd3', 'd4', 'd5'],['d6', 'd7']],
   			        'options':[]
  			    }
				,
				
  			    'input':
				{
   			        'id':['p100', 'p200'],
   			        'options':[]
   			    },
  			    'output':['p5', 'p6'],
			  
  			    'map':
			    [    //所有的id为一个字符加一个无符号数   p代表蛋白质 e代表反应 d代表dna
    			    {id:'e1', id1:'d2', id2:'p2', type:'trans'},
     			    {id:'e2', id1:'p2', id2:'d4', type:'inh'},
     			    {id:'e3', id1:'p100', id2:'e2', type:'inh'},
    			    {id:'e4', id1:'d3', id2:'p3', type:'trans'},
					{id:'e5', id1:'p3', id2:'d6', type:'inh'},
					{id:'e6', id1:'p200', id2:'e5', type:'inh'}
					
  			    ],
				
   			    'posloc':
  			    [
  			        {from:'d2', to:'d3', l1:0, l2:0}
  			    ]   
			},
			{
			    'id': 0,
   			    'name': 'test',
  			    'icon':  'or',
				
  			    'type': 
				{
   			        'type': null,
   			        'function': '',
    			    'chassis':'',
  			        'standard':'',
  			        'contributor':''
  			    },
				
  			    'lines':
				{
   			        'id':[['d1', 'd2', 'd3', 'd4', 'd5']],
   			        'options':[]
  			    }
				,
				
  			    'input':
				{
   			        'id':['p100', 'p200'],
   			        'options':[]
   			    },
  			    'output':['p5', 'p6'],
			  
  			    'map':
			    [    //所有的id为一个字符加一个无符号数   p代表蛋白质 e代表反应 d代表dna
    			    {id:'e1', id1:'d2', id2:'p2', type:'trans'},
     			    {id:'e2', id1:'p2', id2:'d4', type:'inh'},
     			    {id:'e3', id1:'p100', id2:'e2', type:'inh'},
    			    {id:'e4', id1:'d3', id2:'p3', type:'trans'},
					{id:'e5', id1:'p3', id2:'d4', type:'inh'},
					{id:'e6', id1:'p200', id2:'e5', type:'inh'}
					
  			    ],
				
   			    'posloc':
  			    [
  			        {from:'d3', to:'d4', l1:0, l2:0}
  			    ]   
			}];//测试用devices
			renderer = PIXI.autoDetectRenderer($("body").width(), $("body").height() - $("nav").height(), {view : document.getElementById("canvas"), antialias : true, backgroundColor : 0xabcdef});
            if(!renderer)
                return;
			var homeStage = HomePage.Draw(Devices, renderer.width, renderer.height);
			var stage = homeStage;
			animate();
	        function animate() {
 				   renderer.render(stage);
 				   requestAnimationFrame(animate);
	        };
			
			var scrollFunc=function(e){
                var d = 0;
                e = e || window.event;
                
                if(e.wheelDelta){//IE/Opera/Chrome
                    d = e.wheelDelta;
                }else if(e.detail){//Firefox
                    d = e.detail;
                };
			    var f = function(x){
    				if(Math.abs(HomePage.childStage.scale.x - x) > 0.001){
						HomePage.childStage.position.x += (HomePage.childStage.scale.x - x) * 0.1 * HomePage.childStage.inPosition.x;
						HomePage.childStage.position.y += (HomePage.childStage.scale.y - x) * 0.1 * HomePage.childStage.inPosition.y;
	    				HomePage.childStage.scale.x -= (HomePage.childStage.scale.x - x) * 0.1;
		    	        HomePage.childStage.scale.y -= (HomePage.childStage.scale.y - x) * 0.1;
			    		requestAnimationFrame(f(x));
				    };
               };
	    		if(d > 0){
		    		if(HomePage.childStage.scale.x > 1.2)
			    	    return;
				
				    f(HomePage.childStage.scale.x + 0.05);
				
    			}else{
	    			if(HomePage.childStage.scale.x < 0.25)
		    		    return;
			    	f(HomePage.childStage.scale.x - 0.05);
    			}
            }
            /*注册事件*/
            if(document.addEventListener){
                document.addEventListener('DOMMouseScroll',scrollFunc,false);
            }//W3C
            window.onmousewheel=document.onmousewheel=scrollFunc;//IE/Opera/Chrome/Safari
			
		});
    </script>
</head>
<body>
    <nav>
        <p>AppName</p>
        <ul>
            <li id="home">Home</li>
            <li id="device">Device</li>
            <li>Test2</li>
        </ul>
    </nav>
    <canvas id="canvas">Your browser does not support canvas, please consider to use <a href="https://www.google.com/chrome/">latest Chrome</a>.</canvas>
</body>
</html>
